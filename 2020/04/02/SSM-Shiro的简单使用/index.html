<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>SSM-Shiro的简单使用 | XiaoMing's Blog</title><meta name="description" content="SSM-Shiro的简单使用"><meta name="keywords" content="SSM,Shiro"><meta name="author" content="XiaoMing"><meta name="copyright" content="XiaoMing"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><meta name="twitter:card" content="summary"><meta name="twitter:title" content="SSM-Shiro的简单使用"><meta name="twitter:description" content="SSM-Shiro的简单使用"><meta name="twitter:image" content="https://i.loli.net/2020/03/15/os7tu9STUCWx6Qe.jpg"><meta property="og:type" content="article"><meta property="og:title" content="SSM-Shiro的简单使用"><meta property="og:url" content="https://xiaoming0929.github.io/2020/04/02/SSM-Shiro%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"><meta property="og:site_name" content="XiaoMing's Blog"><meta property="og:description" content="SSM-Shiro的简单使用"><meta property="og:image" content="https://i.loli.net/2020/03/15/os7tu9STUCWx6Qe.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="https://xiaoming0929.github.io/2020/04/02/SSM-Shiro%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"><link rel="prev" title="集合大杂烩" href="https://xiaoming0929.github.io/2020/04/02/%E9%9B%86%E5%90%88%E5%A4%A7%E6%9D%82%E7%83%A9/"><link rel="next" title="Servlet页面跳转-浅谈重定向和请求转发" href="https://xiaoming0929.github.io/2020/04/02/Servlet%E9%A1%B5%E9%9D%A2%E8%B7%B3%E8%BD%AC-%E6%B5%85%E8%B0%88%E9%87%8D%E5%AE%9A%E5%90%91%E5%92%8C%E8%AF%B7%E6%B1%82%E8%BD%AC%E5%8F%91/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://XiaoMing0929.github.io","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: {"languages":{"author":"作者: XiaoMing","link":"链接: https://xiaoming0929.github.io/2020/04/02/SSM-Shiro%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/","source":"来源: XiaoMing's Blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"title":"Snackbar.bookmark.title","message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.0"></head><body><canvas class="fireworks"></canvas><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">XiaoMing's Blog</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-heartbeat" aria-hidden="true"></i><span> 清单</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/Gallery/"><i class="fa-fw fa fa-picture-o"></i><span> 照片</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">20</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">33</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">13</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-heartbeat" aria-hidden="true"></i><span> 清单</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/Gallery/"><i class="fa-fw fa fa-picture-o"></i><span> 照片</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#写在前面-小仙呕心沥血学习之笔记-不足之处请指出-转载请注明出处"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">写在前面:小仙呕心沥血学习之笔记,不足之处请指出,转载请注明出处.</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#环境-idea-mysql-jdk8"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">环境:idea,mysql,jdk8</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#1-为什么要使用shiro"><span class="toc_mobile_items-number"></span> <span class="toc_mobile_items-text">1 为什么要使用shiro?</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#2-Shiro简介"><span class="toc_mobile_items-number"></span> <span class="toc_mobile_items-text">2 Shiro简介:</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#3-与ssm项目的集成"><span class="toc_mobile_items-number"></span> <span class="toc_mobile_items-text">3 与ssm项目的集成</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#3-1-pom-xml"><span class="toc_mobile_items-number"></span> <span class="toc_mobile_items-text">3.1 pom.xml</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#3-2-web-xml"><span class="toc_mobile_items-number"></span> <span class="toc_mobile_items-text">3.2  web.xml</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#3-3-shiro-ini"><span class="toc_mobile_items-number"></span> <span class="toc_mobile_items-text">3.3  shiro.ini</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#3-4-jsp"><span class="toc_mobile_items-number"></span> <span class="toc_mobile_items-text">3.4  jsp</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#在webapp目录下定义-index-jsp"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">在webapp目录下定义:index.jsp</span></a></li></ol></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#"><span class="toc_mobile_items-number"></span> <span class="toc_mobile_items-text">Index.jsp</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#在webapp目录下定义-error-jsp"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">在webapp目录下定义:error.jsp</span></a></li></ol></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#"><span class="toc_mobile_items-number"></span> <span class="toc_mobile_items-text">Permission denied</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#在webapp-WEB-INF目录下定义-login-jsp"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">在webapp&#x2F;WEB-INF目录下定义:login.jsp</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#在webapp-WEB-INF目录下定义-regist-jsp"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">在webapp&#x2F;WEB-INF目录下定义:regist.jsp</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#3-5-自定义Realm-有加密"><span class="toc_mobile_items-number"></span> <span class="toc_mobile_items-text">3.5 自定义Realm(有加密)</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#3-5-1-mysql建表"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">3.5.1 mysql建表</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#3-5-2-bean"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">3.5.2 bean</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#3-5-3-dao"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">3.5.3 dao</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#3-5-4-service"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text">3.5.4 service</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#3-5-5-controller"><span class="toc_mobile_items-number">5.</span> <span class="toc_mobile_items-text">3.5.5 controller</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#3-5-6-自定义Realm"><span class="toc_mobile_items-number">6.</span> <span class="toc_mobile_items-text">3.5.6 自定义Realm</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#3-6-Tomcat-Run"><span class="toc_mobile_items-number"></span> <span class="toc_mobile_items-text">3.6 Tomcat+Run</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#3-7-Over"><span class="toc_mobile_items-number"></span> <span class="toc_mobile_items-text">3.7 Over</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#感谢阅读-希望能对您有帮助-有问题请在留言中指出-祝您生活愉快"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">感谢阅读,希望能对您有帮助,有问题请在留言中指出,祝您生活愉快~</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#求赞"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">求赞~</span></a></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-5"><a class="toc-link" href="#写在前面-小仙呕心沥血学习之笔记-不足之处请指出-转载请注明出处"><span class="toc-number">1.</span> <span class="toc-text">写在前面:小仙呕心沥血学习之笔记,不足之处请指出,转载请注明出处.</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#环境-idea-mysql-jdk8"><span class="toc-number">2.</span> <span class="toc-text">环境:idea,mysql,jdk8</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-为什么要使用shiro"><span class="toc-number"></span> <span class="toc-text">1 为什么要使用shiro?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Shiro简介"><span class="toc-number"></span> <span class="toc-text">2 Shiro简介:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-与ssm项目的集成"><span class="toc-number"></span> <span class="toc-text">3 与ssm项目的集成</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-pom-xml"><span class="toc-number"></span> <span class="toc-text">3.1 pom.xml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-web-xml"><span class="toc-number"></span> <span class="toc-text">3.2  web.xml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-shiro-ini"><span class="toc-number"></span> <span class="toc-text">3.3  shiro.ini</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-jsp"><span class="toc-number"></span> <span class="toc-text">3.4  jsp</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#在webapp目录下定义-index-jsp"><span class="toc-number">1.</span> <span class="toc-text">在webapp目录下定义:index.jsp</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#"><span class="toc-number"></span> <span class="toc-text">Index.jsp</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#在webapp目录下定义-error-jsp"><span class="toc-number">1.</span> <span class="toc-text">在webapp目录下定义:error.jsp</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#"><span class="toc-number"></span> <span class="toc-text">Permission denied</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#在webapp-WEB-INF目录下定义-login-jsp"><span class="toc-number">1.</span> <span class="toc-text">在webapp&#x2F;WEB-INF目录下定义:login.jsp</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#在webapp-WEB-INF目录下定义-regist-jsp"><span class="toc-number">2.</span> <span class="toc-text">在webapp&#x2F;WEB-INF目录下定义:regist.jsp</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-自定义Realm-有加密"><span class="toc-number"></span> <span class="toc-text">3.5 自定义Realm(有加密)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-5-1-mysql建表"><span class="toc-number">1.</span> <span class="toc-text">3.5.1 mysql建表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-5-2-bean"><span class="toc-number">2.</span> <span class="toc-text">3.5.2 bean</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-5-3-dao"><span class="toc-number">3.</span> <span class="toc-text">3.5.3 dao</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-5-4-service"><span class="toc-number">4.</span> <span class="toc-text">3.5.4 service</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-5-5-controller"><span class="toc-number">5.</span> <span class="toc-text">3.5.5 controller</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-5-6-自定义Realm"><span class="toc-number">6.</span> <span class="toc-text">3.5.6 自定义Realm</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-Tomcat-Run"><span class="toc-number"></span> <span class="toc-text">3.6 Tomcat+Run</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7-Over"><span class="toc-number"></span> <span class="toc-text">3.7 Over</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#感谢阅读-希望能对您有帮助-有问题请在留言中指出-祝您生活愉快"><span class="toc-number">1.</span> <span class="toc-text">感谢阅读,希望能对您有帮助,有问题请在留言中指出,祝您生活愉快~</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#求赞"><span class="toc-number">2.</span> <span class="toc-text">求赞~</span></a></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(https://i.loli.net/2020/03/15/os7tu9STUCWx6Qe.jpg)"><div id="post-info"><div id="post-title"><div class="posttitle">SSM-Shiro的简单使用</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 2020-04-02<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2020-04-02</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/SSM/">SSM</a></span><div class="post-meta-wordcount"><i class="fa fa-file-word-o post-meta__icon fa-fw" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">3.4k</span><span class="post-meta__separator">|</span><i class="fa fa-clock-o post-meta__icon fa-fw" aria-hidden="true"></i><span>阅读时长: 14 分钟</span><div class="post-meta-pv-cv"></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><html><head></head><body><blockquote>
<h5 id="写在前面-小仙呕心沥血学习之笔记-不足之处请指出-转载请注明出处"><a href="#写在前面-小仙呕心沥血学习之笔记-不足之处请指出-转载请注明出处" class="headerlink" title="写在前面:小仙呕心沥血学习之笔记,不足之处请指出,转载请注明出处."></a>写在前面:小仙呕心沥血学习之笔记,不足之处请指出,转载请注明出处.</h5><h5 id="环境-idea-mysql-jdk8"><a href="#环境-idea-mysql-jdk8" class="headerlink" title="环境:idea,mysql,jdk8"></a>环境:idea,mysql,jdk8</h5></blockquote>
<h3 id="1-为什么要使用shiro"><a href="#1-为什么要使用shiro" class="headerlink" title="1 为什么要使用shiro?"></a>1 为什么要使用shiro?</h3><blockquote>
<ol>
<li>项目中的密码在数据库中的存储要保障安全性,不被恶意攻击盗取,就不能使用明文存储,最好使用不可逆转的加密方式处理之后再存进数据库中;</li>
<li>项目网站的页面,请求是否可以任意访问,是否需要登录后访问一些功能,是不是需要做一些相关的安全性校验?</li>
<li>项目中的各种操作,是不是任意的操作者都可以进行操作,有没有一个身份的区分?</li>
</ol>
<p>综上所述,我们需要进行一些安全校验以保障整个系统的安全,维护一个良好的运行秩序.</p>
</blockquote>
<h3 id="2-Shiro简介"><a href="#2-Shiro简介" class="headerlink" title="2 Shiro简介:"></a>2 Shiro简介:</h3><p>精简了Shiro的主要概要,不啰嗦,如下所示:</p>
<blockquote>
<ol>
<li>三个关键字:Simple,Java,Security,即是Java的一个轻量级的安全框架:<br><a href="https://img-blog.csdnimg.cn/20190530084948910.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption="在这里插入图片描述" class="fancybox"><img alt="在这里插入图片描述" title="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/20190530084948910.jpg" class="lazyload"></a></li>
<li>四大主要功能:Authentication,Authorization,Cryptography,Session Manager,即身份认证,权限验证,加密,会话管理,基本结构如下图:<br><a href="https://img-blog.csdnimg.cn/20190530085303318.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0RlYXJfVVU=,size_16,color_FFFFFF,t_70" target="_blank" rel="noopener" data-fancybox="group" data-caption="在这里插入图片描述" class="fancybox"><img alt="在这里插入图片描述" title="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/20190530085303318.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0RlYXJfVVU=,size_16,color_FFFFFF,t_70" class="lazyload"></a></li>
<li>三大护法(运行流程中的三个核心组件):Subject,SecurityManager,Realm,即当前用户,安全管理器(管理着所有的Subject),安全访问数据的入口(安全管理器SecurityManager要从Realm中获取用户信息进行比对校验),流程如下图:<br><a href="https://img-blog.csdnimg.cn/20190530085318996.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0RlYXJfVVU=,size_16,color_FFFFFF,t_70" target="_blank" rel="noopener" data-fancybox="group" data-caption="在这里插入图片描述" class="fancybox"><img alt="在这里插入图片描述" title="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/20190530085318996.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0RlYXJfVVU=,size_16,color_FFFFFF,t_70" class="lazyload"></a></li>
<li>RBAC模型:Role Base Access Control基于角色的访问控制,该模型中主要有3个主体:用户,角色和权限,如下图:<br><a href="https://img-blog.csdnimg.cn/20190530085337347.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption="在这里插入图片描述" class="fancybox"><img alt="在这里插入图片描述" title="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/20190530085337347.jpg" class="lazyload"></a><br>5.底层源码实现,上图:<br><a href="https://img-blog.csdnimg.cn/20190530085608742.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0RlYXJfVVU=,size_16,color_FFFFFF,t_70" target="_blank" rel="noopener" data-fancybox="group" data-caption="在这里插入图片描述" class="fancybox"><img alt="在这里插入图片描述" title="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/20190530085608742.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0RlYXJfVVU=,size_16,color_FFFFFF,t_70" class="lazyload"></a></li>
</ol>
</blockquote>
<h3 id="3-与ssm项目的集成"><a href="#3-与ssm项目的集成" class="headerlink" title="3 与ssm项目的集成"></a>3 与ssm项目的集成</h3><ul>
<li>SSM框架是我自己封装的一个archetype,关于SSM框架的搭建后续有时间会写一篇博文进行补充,在这里我们基于这个框架做shiro的集成.</li>
<li>做完了才发现我只是做了一个与web的集成,并没有做与Spring的集成,不过没影响,与web集成的不同的地方就是通过spring集成有,可以直接将shiro.ini文件中的配置的组件,迁移到spring的配置文件中,依赖换成shiro-spring就好啦,有兴趣可以自己试一下.</li>
</ul>
<h4 id="3-1-pom-xml"><a href="#3-1-pom-xml" class="headerlink" title="3.1 pom.xml"></a>3.1 pom.xml</h4><blockquote>
<p>首先,在项目的pom.xml文件中加入相关的依赖</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">xml</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><!-- shiro --></span></span><br><span class="line"><span class="comment"><!-- https://mvnrepository.com/artifact/org.apache.shiro/shiro-core --></span></span><br><span class="line"><span class="tag"><<span class="name">dependency</span>></span></span><br><span class="line"> <span class="tag"><<span class="name">groupId</span>></span>org.apache.shiro<span class="tag"><!--<span class="name"-->groupId</span>></span><br><span class="line"> <span class="tag"><<span class="name">artifactId</span>></span>shiro-core<span class="tag"><!--<span class="name"-->artifactId</span>></span><br><span class="line"> <span class="tag"><<span class="name">version</span>></span>1.4.0<span class="tag"><!--<span class="name"-->version</span>></span><br><span class="line"><span class="tag"><!--<span class="name"-->dependency</span>></span><br><span class="line"><span class="comment"><!-- https://mvnrepository.com/artifact/org.apache.shiro/shiro-web --></span></span><br><span class="line"><span class="tag"><<span class="name">dependency</span>></span></span><br><span class="line"> <span class="tag"><<span class="name">groupId</span>></span>org.apache.shiro<span class="tag"><!--<span class="name"-->groupId</span>></span><br><span class="line"> <span class="tag"><<span class="name">artifactId</span>></span>shiro-web<span class="tag"><!--<span class="name"-->artifactId</span>></span><br><span class="line"> <span class="tag"><<span class="name">version</span>></span>1.4.0<span class="tag"><!--<span class="name"-->version</span>></span><br><span class="line"><span class="tag"><!--<span class="name"-->dependency</span>></span><br></pre></td></tr></tbody></table></figure></div>
</blockquote>
<h4 id="3-2-web-xml"><a href="#3-2-web-xml" class="headerlink" title="3.2  web.xml"></a>3.2  web.xml</h4><blockquote>
<p>接下来第二步,在WEB-INF目录下的web.xml文件中安装ShiroFilter(就是做了一些配置,要知道,整个web项目中在项目刚开始运行时,真正加载的资源文件只有这个web.xml文件,resources下的文件也是通过在这个文件中做一些路径的配置加载容器啊之类的):</p>
<p>献上在web.xml文件中shiro的主要配置,<strong>相关讲解看代码前面的注释</strong>:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">xml</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><!-- ShiroFilter:shiro集成的核心过滤器 --></span></span><br><span class="line"><span class="comment"><!-- 可以理解为是一个安保人员,加载web.xml文件后时刻在岗位上等待接收所有的请求并过滤:</span></span><br><span class="line"><span class="comment">	1.其实就是通过请求路径,识别一下是否需要安全校验,需要就触发安全校验</span></span><br><span class="line"><span class="comment">	2.记住这个过滤器的名字,后面的shiro.ini文件中需要使用shiroFilter配置加密--></span></span><br><span class="line"><span class="tag"><<span class="name">filter</span>></span></span><br><span class="line"> <span class="tag"><<span class="name">filter-name</span>></span>shiroFilter<span class="tag"><!--<span class="name"-->filter-name</span>></span><br><span class="line"> <span class="tag"><<span class="name">filter-class</span>></span>org.apache.shiro.web.servlet.ShiroFilter<span class="tag"><!--<span class="name"-->filter-class</span>></span><br><span class="line"><span class="tag"><!--<span class="name"-->filter</span>></span><br><span class="line"><span class="tag"><<span class="name">filter-mapping</span>></span></span><br><span class="line"> <span class="tag"><<span class="name">filter-name</span>></span>shiroFilter<span class="tag"><!--<span class="name"-->filter-name</span>></span><br><span class="line"> <span class="tag"><<span class="name">url-pattern</span>></span>/*<span class="tag"><!--<span class="name"-->url-pattern</span>></span><br><span class="line"><span class="tag"><!--<span class="name"-->filter-mapping</span>></span><br><span class="line"></span><br><span class="line"><span class="comment"><!-- 监听:项目启动后,随之启动shiro,加载WEB-INF或classpath(resources目录下)的shiro.ini文件(我的是放在classpath下),构建SecurityManager</span></span><br><span class="line"><span class="comment">	1.会构建出所有配置中使用的过滤器链(anno,authc等),ShiroFilter会获取系过滤器链 --></span></span><br><span class="line"><span class="tag"><<span class="name">listener</span>></span></span><br><span class="line"> <span class="tag"><<span class="name">listener-class</span>></span>org.apache.shiro.web.env.EnvironmentLoaderListener<span class="tag"><!--<span class="name"-->listener-class</span>></span><br><span class="line"><span class="tag"><!--<span class="name"-->listener</span>></span><br><span class="line"><span class="comment"><!-- 若除了shiro之外你自己定义了其他的.ini文件,则需要通过下面的配置来指定一下自定义文件的名称和位置,如果只有shiro.ini一个文件,那么下面的这个配置不用要 --></span></span><br><span class="line"><span class="tag"><<span class="name">context-param</span>></span></span><br><span class="line"> <span class="tag"><<span class="name">param-name</span>></span>shiroConfigLocation<span class="tag"><!--<span class="name"-->param-name</span>></span><br><span class="line"> <span class="tag"><<span class="name">param-value</span>></span>classpath:shiro_1.ini<span class="tag"><!--<span class="name"-->param-value</span>></span><br><span class="line"><span class="tag"><!--<span class="name"-->context-param</span>></span><br></pre></td></tr></tbody></table></figure></div>

<p>到这里,web.xml文件中的shiro的配置就可以了.</p>
</blockquote>
<h4 id="3-3-shiro-ini"><a href="#3-3-shiro-ini" class="headerlink" title="3.3  shiro.ini"></a>3.3  shiro.ini</h4><ul>
<li><p>首先这个文件放在WEB-INF目录下还是放在resources目录下,全看个人喜好了,多个.ini文件,就要注意一下在web.xml中配置路径的问题的,我的是放在resources目录下的;</p>
<blockquote>
<p>shiro.ini文件有四大配置:[users],[roles],[main],[urls],我们以代码的例子分别介绍标签的主要作用,这个纯属介绍,让你理解什么是什么,用来干什么的(我这样的良心博主不多了,看到这里,还不甩手就是一个大大的赞,再关注一波?),后面再附上准确的shiro.ini文件的相关配置;</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># users:在上面的RBAC(Role Base Access Control)中介绍了shiro的3个主体:用户,角色和权限,这里就是用户和角色的配置:</span></span><br><span class="line"><span class="comment"># 下面users的配置可以解释为:在这个文件中配置了两个用户:</span></span><br><span class="line"><span class="comment"># 1.用户名为zhangsan,密码为111,角色既是teacher又是professor</span></span><br><span class="line"><span class="comment"># 2.用户名为lisi,密码为222,角色为student</span></span><br><span class="line"><span class="section">[users]</span></span><br><span class="line"><span class="attr">zhangsan</span> = <span class="number">111</span>,teacher,professor</span><br><span class="line"><span class="attr">lisi</span> = <span class="number">222</span>,student,</span><br><span class="line"></span><br><span class="line"><span class="comment"># roles:主要是对users中定义的角色相关的权限的配置</span></span><br><span class="line"><span class="comment"># 下面roles的配置可以理解为:</span></span><br><span class="line"><span class="comment"># 1.teacher角色拥有所有的权限</span></span><br><span class="line"><span class="comment"># 2.professor角色拥有user的query和insert的权限</span></span><br><span class="line"><span class="comment"># 3.student角色拥有user下的所有操作权限</span></span><br><span class="line"><span class="section">[roles]</span></span><br><span class="line"><span class="attr">teacher</span> = *</span><br><span class="line"><span class="attr">professor</span> = user:query,user:insert</span><br><span class="line"><span class="attr">student</span> = user:*</span><br><span class="line"></span><br><span class="line"><span class="section">[main]</span></span><br><span class="line"><span class="comment"># 没有身份认证时的跳转路径(这里设置转去登录页)</span></span><br><span class="line"><span class="attr">shiro.loginUrl</span> = /user/login/page</span><br><span class="line"><span class="comment"># 角色或者权限的校验不通过时的跳转路径</span></span><br><span class="line"><span class="attr">shiro.unauthorizedUrl</span> = /login.jsp</span><br><span class="line"><span class="comment"># 登出(注销)后的跳转路径</span></span><br><span class="line"><span class="attr">shiro.redirectUrl</span> = /logout.jsp</span><br><span class="line"><span class="comment"># 由于浏览器可能会有预加载,所以如果登出的请求是get方式,有可能导致用户意外退出,这里强制设置登出的请求方式为post</span></span><br><span class="line"><span class="attr">shiro.postOnlyLogout</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># urls:主要是对访问的请求路径做的安全校验,理解为是一个过滤器拦截吧</span></span><br><span class="line"><span class="comment"># 如:/user/login/page = anon:anno为不需要登录就可以访问,即不需要身份认证</span></span><br><span class="line"><span class="comment"># authc配置的请求路径需要身份认证才能访问</span></span><br><span class="line"><span class="comment"># roles配置请求路径能访问的角色</span></span><br><span class="line"><span class="comment"># perms配置拥有user:update权限或者user:delete权限的才能访问</span></span><br><span class="line"><span class="comment"># logout登出的路径(不用在controller中写一个Handler)</span></span><br><span class="line"><span class="section">[urls]</span></span><br><span class="line">/user/login/page = anon</span><br><span class="line">/user/query = authc</span><br><span class="line">/user/update = authc,roles["manager","seller"]</span><br><span class="line">/user/delete = authc, perms["user:update","user:delete"]</span><br><span class="line">/user/logout = logout</span><br><span class="line"><span class="comment"># 下面的这个要慎用啊(其余路径都需要身份认证),最好是能配置/user/* = authc:user下的其他路径都要身份验证</span></span><br><span class="line">/** = authc</span><br></pre></td></tr></tbody></table></figure></div>

<p>献上[urls]中其他默认的过滤器,如下图:<br><a href="https://img-blog.csdnimg.cn/20190530085819495.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0RlYXJfVVU=,size_16,color_FFFFFF,t_70" target="_blank" rel="noopener" data-fancybox="group" data-caption="在这里插入图片描述" class="fancybox"><img alt="在这里插入图片描述" title="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/20190530085819495.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0RlYXJfVVU=,size_16,color_FFFFFF,t_70" class="lazyload"></a></p>
</blockquote>
</li>
<li><p>由于后面会用自定义的Realm,所以我们的shiro.ini文件配置简化成如下配置:</p>
<blockquote>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">ini</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight ini"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[urls]</span></span><br><span class="line">/user/query=anon</span><br><span class="line">/user/insert=authc,roles["banfu"]</span><br><span class="line">/user/update=authc,perms["student:update"]</span><br><span class="line">/user/delete=authc,roles["xuewei"]</span><br><span class="line">/user/logout=logout</span><br><span class="line"></span><br><span class="line"><span class="section">[main]</span></span><br><span class="line"><span class="attr">shiro.loginUrl</span> = /user/login/page</span><br><span class="line"><span class="attr">shiro.unauthorizedUrl</span>=/error.jsp</span><br><span class="line"><span class="attr">shiro.redirectUrl</span>=/index.jsp</span><br><span class="line"><span class="attr">shiro.postOnlyLogout</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#声明密码比对器</span></span><br><span class="line"><span class="attr">credentialsMatcher</span>=org.apache.shiro.authc.credential.HashedCredentialsMatcher</span><br><span class="line"><span class="attr">credentialsMatcher.hashAlgorithmName</span>=sha-<span class="number">256</span></span><br><span class="line"><span class="attr">credentialsMatcher.hashIterations</span>=<span class="number">1024</span></span><br><span class="line"><span class="comment">#true=hex格式  false=base64格式</span></span><br><span class="line"><span class="attr">credentialsMatcher.storedCredentialsHexEncoded</span>=<span class="literal">false</span></span><br><span class="line"><span class="comment">#比对器关联给realm,则realm中对用户做身份认证时，可以使用加密比对器，对密文做比对</span></span><br><span class="line"><span class="attr">shiroFilter</span> = com.shiro.realm.MyRealm</span><br><span class="line"><span class="attr">shiroFilter.credentialsMatcher</span>=<span class="variable">$credentialsMatcher</span></span><br><span class="line"><span class="attr">securityManager.realms</span>=<span class="variable">$shiroFilter</span></span><br></pre></td></tr></tbody></table></figure></div>
</blockquote>
</li>
</ul>
<h4 id="3-4-jsp"><a href="#3-4-jsp" class="headerlink" title="3.4  jsp"></a>3.4  jsp</h4><ul>
<li><p>在这里定义Controller中 和 shiro.ini中需要的jsp页面,简单的测试,我就简单的写了</p>
<blockquote>
<h5 id="在webapp目录下定义-index-jsp"><a href="#在webapp目录下定义-index-jsp" class="headerlink" title="在webapp目录下定义:index.jsp"></a>在webapp目录下定义:index.jsp</h5><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><%@ taglib prefix=<span class="string">"shiro"</span> uri=<span class="string">"http://shiro.apache.org/tags"</span> %></span><br><span class="line"><%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><h2>Index.jsp</h2></span><br><span class="line"><%-- 是否登录 或 记住我(cookie) --%></span><br><span class="line"><shiro:user></shiro:user></span><br><span class="line"> Hello,<shiro:principal>|</shiro:principal></span><br><span class="line"></span><br><span class="line"><%-- 既没有登录 也 没有记住我 --%></span><br><span class="line"><shiro:guest></shiro:guest></span><br><span class="line"> Hello, please <a href="${pageContext.request.contextPath}/user/login/page">login</a></span><br><span class="line">               <a href="${pageContext.request.contextPath}/user/regist/page">Regist</a>|</span><br><span class="line"></span><br><span class="line"><hr></span><br><span class="line"><%--登录后才能判断--%></span><br><span class="line"><shiro:authenticated></shiro:authenticated></span><br><span class="line"> <shiro:lacksrole name="<span" class="string">"banzhang"</shiro:lacksrole></span>><br><span class="line">     Hello,<shiro:principal> student.</shiro:principal></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><hr></span><br><span class="line"><%--登录后显示登出--%></span><br><span class="line"><shiro:authenticated></shiro:authenticated></span><br><span class="line"> <form action="<span" class="string">"${pageContext.request.contextPath}/user/logout" method=<span class="string">"post"</span>><br><span class="line">     <input type="<span" class="string">"submit"</span> value=<span class="string">"Logout"</span>><br><span class="line"> </span></form><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></span></pre></td></tr></tbody></table></figure></div>

<h5 id="在webapp目录下定义-error-jsp"><a href="#在webapp目录下定义-error-jsp" class="headerlink" title="在webapp目录下定义:error.jsp"></a>在webapp目录下定义:error.jsp</h5><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <title>Error</title></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><h2>Permission denied</h2></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div>

<h5 id="在webapp-WEB-INF目录下定义-login-jsp"><a href="#在webapp-WEB-INF目录下定义-login-jsp" class="headerlink" title="在webapp/WEB-INF目录下定义:login.jsp"></a>在webapp/WEB-INF目录下定义:login.jsp</h5><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <title>Login</title></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><form action="<span" class="string">"${pageContext.request.contextPath}/user/login/logic" method=<span class="string">"put"</span><br><span class="line">   enctype=<span class="string">"application/x-www-form-urlencoded"</span>></span><br><span class="line"> UserName:<input type="<span" class="string">"text"</span> id=<span class="string">"username"</span> name=<span class="string">"username"</span>><br><br><span class="line"> PassWord:<input type="<span" class="string">"text"</span> id=<span class="string">"password"</span> name=<span class="string">"password"</span>><br><br><span class="line"> <input type="<span" class="string">"submit"</span> value=<span class="string">"Login"</span>><br><span class="line"></span></form><br><span class="line"><%--后台没往session中放东西,你可以自己加上--%></span><br><span class="line"><script type="<span" class="string">"text/javascript"</span>></span><br><span class="line"> <span class="keyword">if</span> (<span class="string">'${sessionScope.get("msg")}'</span>==<span class="number">1</span>){</span><br><span class="line">     <%session.setAttribute(<span class="string">"msg"</span>, <span class="number">0</span>);%></span><br><span class="line">     alert(<span class="string">"Username or password wrong!Please try again!"</span>);</span><br><span class="line"> }</span><br><span class="line"></script></span><br><span class="line"></span><br><span class="line"></span><br></span></pre></td></tr></tbody></table></figure></div>

<h5 id="在webapp-WEB-INF目录下定义-regist-jsp"><a href="#在webapp-WEB-INF目录下定义-regist-jsp" class="headerlink" title="在webapp/WEB-INF目录下定义:regist.jsp"></a>在webapp/WEB-INF目录下定义:regist.jsp</h5><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <title>Regist</title></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><form action="<span" class="string">"${pageContext.request.contextPath}/user/regist/logic" method=<span class="string">"put"</span><br><span class="line">   enctype=<span class="string">"application/x-www-form-urlencoded"</span>></span><br><span class="line"> UserName:<input type="<span" class="string">"text"</span> id=<span class="string">"username"</span> name=<span class="string">"username"</span>><br><br><span class="line"> PassWord:<input type="<span" class="string">"text"</span> id=<span class="string">"password"</span> name=<span class="string">"password"</span>><br><br><span class="line"> <input type="<span" class="string">"submit"</span> value=<span class="string">"Regist"</span>><br><span class="line"></span></form><br><span class="line"><%--后台没往session中放东西,你可以自己加上--%></span><br><span class="line"><script type="<span" class="string">"text/javascript"</span>></span><br><span class="line"> <span class="keyword">if</span> (<span class="string">'${sessionScope.get("msg")}'</span>==<span class="number">1</span>){</span><br><span class="line">     <%session.setAttribute(<span class="string">"msg"</span>, <span class="number">0</span>);%></span><br><span class="line">     alert(<span class="string">"Regist failure!Please try again!"</span>);</span><br><span class="line"> }</span><br><span class="line"></script></span><br><span class="line"></span><br><span class="line"></span><br></span></pre></td></tr></tbody></table></figure></div>
</blockquote>
</li>
</ul>
<h4 id="3-5-自定义Realm-有加密"><a href="#3-5-自定义Realm-有加密" class="headerlink" title="3.5 自定义Realm(有加密)"></a>3.5 自定义Realm(有加密)</h4><ul>
<li>这一节我们从数据库开始说,从后向前dao,service,controller,自定义realm类,只能说,到位了!</li>
</ul>
<h5 id="3-5-1-mysql建表"><a href="#3-5-1-mysql建表" class="headerlink" title="3.5.1 mysql建表"></a>3.5.1 mysql建表</h5><ul>
<li><p>一共5张表:用户表,角色表,用户角色关联表,权限表,权限角色关联表<br><a href="https://img-blog.csdnimg.cn/20190530085421445.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0RlYXJfVVU=,size_16,color_FFFFFF,t_70" target="_blank" rel="noopener" data-fancybox="group" data-caption="在这里插入图片描述" class="fancybox"><img alt="在这里插入图片描述" title="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/20190530085421445.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0RlYXJfVVU=,size_16,color_FFFFFF,t_70" class="lazyload"></a></p>
<blockquote>
<p>这里只给出建表语句,表中数据的添加不再赘述:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">create database usershiro default charset=utf8;</span><br><span class="line">create table t_user(</span><br><span class="line">	id int primary key auto_increment,</span><br><span class="line"> username varchar(20) not null unique,</span><br><span class="line"> password varchar(100) not null</span><br><span class="line">)engine=innodb default charset=utf8;</span><br><span class="line"></span><br><span class="line">create table t_role(</span><br><span class="line">	id int primary key auto_increment,</span><br><span class="line">	role_name varchar(50) not null unique,</span><br><span class="line">	create_time timestamp not null</span><br><span class="line">)engine=innodb default charset=utf8;</span><br><span class="line"></span><br><span class="line">create table t_permission(</span><br><span class="line">	id int primary key auto_increment,</span><br><span class="line">	permission_name varchar(50) not null unique,</span><br><span class="line">	create_time timestamp</span><br><span class="line">)engine=innodb default charset=utf8;</span><br><span class="line"></span><br><span class="line">create table t_user_role(</span><br><span class="line">	id int primary key auto_increment,</span><br><span class="line">	user_id int references t_user(id),</span><br><span class="line">	role_id int references t_role(id),</span><br><span class="line">	unique(user_id,role_id)</span><br><span class="line">)engine=innodb default charset=utf8;</span><br><span class="line"></span><br><span class="line">create table t_role_permission(</span><br><span class="line">	id int primary key auto_increment,</span><br><span class="line">	permission_id int references t_user(id),</span><br><span class="line">	role_id int references t_role(id),</span><br><span class="line">	unique(permission_id,role_id)</span><br><span class="line">)engine=innodb default charset=utf8;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div>
</blockquote>
</li>
</ul>
<h5 id="3-5-2-bean"><a href="#3-5-2-bean" class="headerlink" title="3.5.2 bean"></a>3.5.2 bean</h5><ul>
<li>我们只用到了User.java,根据数据库表中的属性,创建一个用户类是闭着眼睛也能做出来的事,再贴这个代码就说明low爆了…略过~~</li>
</ul>
<h5 id="3-5-3-dao"><a href="#3-5-3-dao" class="headerlink" title="3.5.3 dao"></a>3.5.3 dao</h5><ul>
<li><p>com.shiro.dao目录下主要是放了dao层的封装接口和.xml映射实现文件</p>
</li>
<li><p>我们在这里只实现用户登录注册的shiro安全校验</p>
<blockquote>
<p>UserMapper.java</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.shiro.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.shiro.bean.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>{</span><br><span class="line"> <span class="function"><span class="keyword">public</span> User <span class="title">queryUserByUsername</span><span class="params">(String username)</span></span>;</span><br><span class="line"> <span class="function"><span class="keyword">public</span> Integer <span class="title">insertUser</span><span class="params">(User user)</span></span>;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div>

<p>UserMapper.xml</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">xml</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"><!--?xml version="1.0" encoding="utf-8"?--></span></span><br><span class="line"><span class="meta">mapper</span></span><br><span class="line"><span class="meta">     <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">     <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>></span></span><br><span class="line"><span class="tag"><<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.shiro.dao.UserMapper"</span>></span></span><br><span class="line"> <span class="tag"><<span class="name">select</span> <span class="attr">id</span>=<span class="string">"queryUserByUsername"</span> <span class="attr">resultType</span>=<span class="string">"User"</span> <span class="attr">parameterType</span>=<span class="string">"string"</span>></span></span><br><span class="line">     select id,username,password,salt</span><br><span class="line">     from t_user</span><br><span class="line">     where username = #{username}</span><br><span class="line"> <span class="tag"><!--<span class="name"-->select</span>></span><br><span class="line"> <span class="tag"><<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertUser"</span> <span class="attr">parameterType</span>=<span class="string">"User"</span>></span></span><br><span class="line">     insert into t_user(username,password,salt)</span><br><span class="line">     values(#{username},#{password},#{salt})</span><br><span class="line"> <span class="tag"><!--<span class="name"-->insert</span>></span><br><span class="line"><span class="tag"><!--<span class="name"-->mapper</span>></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div>

<p>RoleMApper.java</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.shiro.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">RoleMapper</span> </span>{</span><br><span class="line"> <span class="function"><span class="keyword">public</span> Set<string> <span class="title">queryRoleByUsername</span><span class="params">(String username)</span></string></span>;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div>

<p>RoleMapper.xml</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">xml</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"><!--?xml version="1.0" encoding="utf-8"?--></span></span><br><span class="line"><span class="meta">mapper</span></span><br><span class="line"><span class="meta">     <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">     <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>></span></span><br><span class="line"><span class="tag"><<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.shiro.dao.RoleMapper"</span>></span></span><br><span class="line"> <span class="tag"><<span class="name">select</span> <span class="attr">id</span>=<span class="string">"queryRoleByUsername"</span> <span class="attr">resultType</span>=<span class="string">"string"</span> <span class="attr">parameterType</span>=<span class="string">"string"</span>></span></span><br><span class="line">     select t_role.role_name</span><br><span class="line">     from t_user join t_user_role</span><br><span class="line">     on t_user.id = t_user_role.user_id</span><br><span class="line">     join t_role</span><br><span class="line">     ON t_role.id = t_user_role.role_id</span><br><span class="line">     where t_user.username = #{username}</span><br><span class="line"> <span class="tag"><!--<span class="name"-->select</span>></span><br><span class="line"><span class="tag"><!--<span class="name"-->mapper</span>></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div>

<p>PermissionMapper.java</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.shiro.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PermissionMapper</span> </span>{</span><br><span class="line"> <span class="function"><span class="keyword">public</span> Set<string> <span class="title">queryPermissionByUsername</span><span class="params">(String username)</span></string></span>;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div>

<p>PermissionMapper.xml</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">xml</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"><!--?xml version="1.0" encoding="utf-8"?--></span></span><br><span class="line"><span class="meta">mapper</span></span><br><span class="line"><span class="meta">     <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">     <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>></span></span><br><span class="line"><span class="tag"><<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.shiro.dao.PermissionMapper"</span>></span></span><br><span class="line"> <span class="tag"><<span class="name">select</span> <span class="attr">id</span>=<span class="string">"queryPermissionByUsername"</span> <span class="attr">resultType</span>=<span class="string">"string"</span> <span class="attr">parameterType</span>=<span class="string">"string"</span>></span></span><br><span class="line">     select t_permission.permission_name</span><br><span class="line">     from t_user join t_user_role</span><br><span class="line">     on t_user.id = t_user_role.user_id</span><br><span class="line">     join t_role</span><br><span class="line">     ON t_role.id = t_user_role.role_id</span><br><span class="line">     join t_role_permission</span><br><span class="line">     on t_role.id = t_role_permission.role_id</span><br><span class="line">     JOIN t_permission</span><br><span class="line">     on t_role_permission.permission_id=t_permission.id</span><br><span class="line">     where t_user.username = #{username}</span><br><span class="line"> <span class="tag"><!--<span class="name"-->select</span>></span><br><span class="line"><span class="tag"><!--<span class="name"-->mapper</span>></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div>
</blockquote>
</li>
</ul>
<h5 id="3-5-4-service"><a href="#3-5-4-service" class="headerlink" title="3.5.4 service"></a>3.5.4 service</h5><ul>
<li><p>com.shiro.service需要注意的一点就是用户在注册时,密码在这层做了加密的操作,这个加密就很恶心,让人看了就不想去破解的那种;</p>
</li>
<li><p>加密原理:属于<strong>加盐多次迭代</strong>的加密过程,举个例子吧,我们用sha-256进行加密,加入迭代了两次,第一次 sha-256(明文+salt)=密文a 第二次迭代 sha-256(密文a+salt)=最终密文</p>
</li>
<li><p>建议迭代次数为1000+,没开玩笑,严肃点不许笑!哈哈哈</p>
<blockquote>
<p>UserService.java</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.shiro.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.shiro.bean.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>{</span><br><span class="line"> <span class="function"><span class="keyword">public</span> User <span class="title">queryUserByUsername</span><span class="params">(String username)</span></span>;</span><br><span class="line"> <span class="function"><span class="keyword">public</span> Integer <span class="title">createUser</span><span class="params">(User user)</span></span>;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div>

<p>UserServiceImpl.java</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.shiro.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.shiro.bean.User;</span><br><span class="line"><span class="keyword">import</span> com.shiro.dao.UserMapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.crypto.hash.Sha256Hash;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>{</span><br><span class="line"> <span class="meta">@Autowired</span></span><br><span class="line"> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> User <span class="title">queryUserByUsername</span><span class="params">(String username)</span> </span>{</span><br><span class="line">     <span class="keyword">return</span> userMapper.queryUserByUsername(username);</span><br><span class="line"> }</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Transactional</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> Integer <span class="title">createUser</span><span class="params">(User user)</span> </span>{</span><br><span class="line">     String salt = UUID.randomUUID().toString();</span><br><span class="line">     <span class="comment">// 将用户密码加密</span></span><br><span class="line">     String password = <span class="keyword">new</span> Sha256Hash(user.getPassword(), salt, <span class="number">1024</span>).toBase64();</span><br><span class="line">     <span class="comment">// 覆盖用户输入的明文密码</span></span><br><span class="line">     user.setPassword(password);</span><br><span class="line">     user.setSalt(salt);</span><br><span class="line">     Integer count = userMapper.insertUser(user);</span><br><span class="line">     <span class="keyword">return</span> count;</span><br><span class="line"> }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div>

<p>RoleService.java</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.shiro.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">RoleService</span> </span>{</span><br><span class="line"> <span class="function"><span class="keyword">public</span> Set<string> <span class="title">queryRoleByUsername</span><span class="params">(String username)</span></string></span>;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div>

<p>RoleServiceImpl.java</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.shiro.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.shiro.dao.RoleMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RoleServiceImpl</span> <span class="keyword">implements</span> <span class="title">RoleService</span> </span>{</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Autowired</span></span><br><span class="line"> RoleMapper roleMapper;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> Set<string> <span class="title">queryRoleByUsername</span><span class="params">(String username)</span> </string></span>{</span><br><span class="line">     <span class="keyword">return</span> roleMapper.queryRoleByUsername(username);</span><br><span class="line"> }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div>

<p>PermissionService.java</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.shiro.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PermissionService</span> </span>{</span><br><span class="line"> <span class="function"><span class="keyword">public</span> Set<string> <span class="title">queryPermissionByUsername</span><span class="params">(String username)</span></string></span>;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div>

<p>PermissionServiceImpl.java</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.shiro.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.shiro.dao.PermissionMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PermissionServiceImpl</span> <span class="keyword">implements</span> <span class="title">PermissionService</span> </span>{</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Autowired</span></span><br><span class="line"> PermissionMapper permissionMapper;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> Set<string> <span class="title">queryPermissionByUsername</span><span class="params">(String username)</span> </string></span>{</span><br><span class="line">     <span class="keyword">return</span> permissionMapper.queryPermissionByUsername(username);</span><br><span class="line"> }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div>
</blockquote>
</li>
</ul>
<h5 id="3-5-5-controller"><a href="#3-5-5-controller" class="headerlink" title="3.5.5 controller"></a>3.5.5 controller</h5><ul>
<li><p>这里仅用了一个UserController,做了登录注册的实现,其他的模拟</p>
<blockquote>
<p>UserController.java</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.shiro.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.shiro.bean.User;</span><br><span class="line"><span class="keyword">import</span> com.shiro.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.SecurityUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.IncorrectCredentialsException;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.UnknownAccountException;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.UsernamePasswordToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.Subject;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/user"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span></span>{</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Autowired</span></span><br><span class="line"> UserService userService;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@RequestMapping</span>(<span class="string">"/query"</span>)</span><br><span class="line"> <span class="function"><span class="keyword">public</span> String <span class="title">userQuery</span><span class="params">()</span></span>{</span><br><span class="line">     System.out.println(<span class="string">"User query..."</span>);</span><br><span class="line">     <span class="keyword">return</span> <span class="string">"index"</span>;</span><br><span class="line"> }</span><br><span class="line"></span><br><span class="line"> <span class="meta">@RequestMapping</span>(<span class="string">"/insert"</span>)</span><br><span class="line"> <span class="function"><span class="keyword">public</span> String <span class="title">userInsert</span><span class="params">()</span></span>{</span><br><span class="line">     System.out.println(<span class="string">"User insert..."</span>);</span><br><span class="line">     <span class="keyword">return</span> <span class="string">"index"</span>;</span><br><span class="line"> }</span><br><span class="line"></span><br><span class="line"> <span class="meta">@RequestMapping</span>(<span class="string">"/update"</span>)</span><br><span class="line"> <span class="function"><span class="keyword">public</span> String <span class="title">userUpdate</span><span class="params">()</span></span>{</span><br><span class="line">     System.out.println(<span class="string">"User update..."</span>);</span><br><span class="line">     <span class="keyword">return</span> <span class="string">"index"</span>;</span><br><span class="line"> }</span><br><span class="line"></span><br><span class="line"> <span class="meta">@RequestMapping</span>(<span class="string">"/delete"</span>)</span><br><span class="line"> <span class="function"><span class="keyword">public</span> String <span class="title">userDelete</span><span class="params">()</span></span>{</span><br><span class="line">     System.out.println(<span class="string">"User delete..."</span>);</span><br><span class="line">     <span class="keyword">return</span> <span class="string">"index"</span>;</span><br><span class="line"> }</span><br><span class="line"></span><br><span class="line"> <span class="meta">@RequestMapping</span>(<span class="string">"/login/page"</span>)</span><br><span class="line"> <span class="function"><span class="keyword">public</span> String <span class="title">userLoginPage</span><span class="params">()</span></span>{</span><br><span class="line">     System.out.println(<span class="string">"User login page..."</span>);</span><br><span class="line">     <span class="keyword">return</span> <span class="string">"WEB-INF/login"</span>;</span><br><span class="line"> }</span><br><span class="line"></span><br><span class="line"> <span class="meta">@RequestMapping</span>(<span class="string">"/login/logic"</span>)</span><br><span class="line"> <span class="function"><span class="keyword">public</span> String <span class="title">userLoginLogic</span><span class="params">(String username,String password)</span></span>{</span><br><span class="line">     System.out.println(<span class="string">"User login logic..."</span>);</span><br><span class="line">     UsernamePasswordToken token = <span class="keyword">new</span> UsernamePasswordToken(username, password);</span><br><span class="line">     Subject subject = SecurityUtils.getSubject();</span><br><span class="line">     <span class="keyword">try</span> {</span><br><span class="line">         subject.login(token);</span><br><span class="line">         <span class="keyword">return</span> <span class="string">"index"</span>;</span><br><span class="line">     } <span class="keyword">catch</span> (UnknownAccountException e){</span><br><span class="line">         System.out.println(<span class="string">"UnknownAccountException:"</span>+e.getMessage());</span><br><span class="line">     } <span class="keyword">catch</span> (IncorrectCredentialsException e){</span><br><span class="line">         System.out.println(<span class="string">"IncorrectCredentialsException:"</span>+e.getMessage());</span><br><span class="line">     }</span><br><span class="line">     <span class="keyword">return</span> <span class="string">"redirect:/user/login/page"</span>;</span><br><span class="line"> }</span><br><span class="line"></span><br><span class="line"> <span class="meta">@RequestMapping</span>(<span class="string">"/regist/page"</span>)</span><br><span class="line"> <span class="function"><span class="keyword">public</span> String <span class="title">userRegistPage</span><span class="params">()</span></span>{</span><br><span class="line">     System.out.println(<span class="string">"User regist page..."</span>);</span><br><span class="line">     <span class="keyword">return</span> <span class="string">"WEB-INF/regist"</span>;</span><br><span class="line"> }</span><br><span class="line"></span><br><span class="line"> <span class="meta">@RequestMapping</span>(<span class="string">"/regist/logic"</span>)</span><br><span class="line"> <span class="function"><span class="keyword">public</span> String <span class="title">userRegistLogic</span><span class="params">(User user)</span></span>{</span><br><span class="line">     System.out.println(<span class="string">"User regist logic..."</span>);</span><br><span class="line">     userService.createUser(user);</span><br><span class="line">     <span class="keyword">return</span> <span class="string">"redirect:/user/login/page"</span>;</span><br><span class="line"> }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div>
</blockquote>
</li>
</ul>
<h5 id="3-5-6-自定义Realm"><a href="#3-5-6-自定义Realm" class="headerlink" title="3.5.6 自定义Realm"></a>3.5.6 自定义Realm</h5><ul>
<li><p>Realm的职责是为shiro加载用户,角色和权限数据以提供shiro内部校验</p>
</li>
<li><p>有一定需要明确若自定义的Realm只负责身份校验,可以继承:AuthenticatingRealm</p>
</li>
<li><p>若自定义的Realm类不仅要负责身份校验,还要负责权限校验,那就要继承:AuthorizingRealm</p>
<blockquote>
<p>MyRealm.java</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.shiro.realm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.shiro.bean.User;</span><br><span class="line"><span class="keyword">import</span> com.shiro.service.PermissionService;</span><br><span class="line"><span class="keyword">import</span> com.shiro.service.RoleService;</span><br><span class="line"><span class="keyword">import</span> com.shiro.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.AuthorizationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.SimpleAuthorizationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.realm.AuthorizingRealm;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.PrincipalCollection;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.util.ByteSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.ContextLoader;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.WebApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRealm</span> <span class="keyword">extends</span> <span class="title">AuthorizingRealm</span> </span>{</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 是否支持token(包含username和password)</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supports</span><span class="params">(AuthenticationToken token)</span> </span>{</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (token <span class="keyword">instanceof</span> UsernamePasswordToken){</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">     }</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"> }</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException </span>{</span><br><span class="line">     <span class="comment">// 1.获取username</span></span><br><span class="line">     String username = (String) token.getPrincipal();</span><br><span class="line">     System.out.println(<span class="string">"username:"</span>+username);</span><br><span class="line"></span><br><span class="line">     <span class="comment">// 2.查询用户身份信息</span></span><br><span class="line">     <span class="comment">// 2.1 获取Spring工厂</span></span><br><span class="line">     WebApplicationContext context = ContextLoader.getCurrentWebApplicationContext();</span><br><span class="line">     UserService userService = (UserService) context.getBean(<span class="string">"userServiceImpl"</span>);</span><br><span class="line">     User user = userService.queryUserByUsername(username);</span><br><span class="line">     <span class="comment">// 3.将用户信息封装成一个AuthenticationInfo</span></span><br><span class="line">     <span class="keyword">if</span> (user!=<span class="keyword">null</span>) {</span><br><span class="line">         <span class="comment">// 加密处理过的</span></span><br><span class="line">         SimpleAuthenticationInfo info = <span class="keyword">new</span> SimpleAuthenticationInfo(user.getUsername(),</span><br><span class="line">                 user.getPassword(),</span><br><span class="line">                 ByteSource.Util.bytes(user.getSalt()),</span><br><span class="line">                 getName());</span><br><span class="line">         <span class="keyword">return</span> info;</span><br><span class="line">     }</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line"> }</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">protected</span> AuthorizationInfo <span class="title">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principals)</span> </span>{</span><br><span class="line">     <span class="comment">// 1.获取username</span></span><br><span class="line">     String username = (String) principals.getPrimaryPrincipal();</span><br><span class="line">     <span class="comment">// 2.获取Spring工厂</span></span><br><span class="line">     WebApplicationContext context = ContextLoader.getCurrentWebApplicationContext();</span><br><span class="line">     RoleService roleService = (RoleService) context.getBean(<span class="string">"roleServiceImpl"</span>);</span><br><span class="line">     PermissionService permissionService = (PermissionService) context.getBean(<span class="string">"permissionServiceImpl"</span>);</span><br><span class="line">     Set<string> roles = roleService.queryRoleByUsername(username);</string></span><br><span class="line">     Set<string> permissions = permissionService.queryPermissionByUsername(username);</string></span><br><span class="line">     <span class="keyword">for</span> (String role : roles) {</span><br><span class="line">         System.out.print(role+<span class="string">"/"</span>);</span><br><span class="line">     }</span><br><span class="line">     System.out.println();</span><br><span class="line">     <span class="keyword">for</span> (String permission : permissions) {</span><br><span class="line">         System.out.print(permission+<span class="string">"/"</span>);</span><br><span class="line">     }</span><br><span class="line">     <span class="comment">// 3.将查询到的roles和permissions封装</span></span><br><span class="line">     SimpleAuthorizationInfo info = <span class="keyword">new</span> SimpleAuthorizationInfo();</span><br><span class="line">     info.setRoles(roles);</span><br><span class="line">     info.setStringPermissions(permissions);</span><br><span class="line">     <span class="keyword">return</span> info;</span><br><span class="line"> }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div>
</blockquote>
</li>
</ul>
<h4 id="3-6-Tomcat-Run"><a href="#3-6-Tomcat-Run" class="headerlink" title="3.6 Tomcat+Run"></a>3.6 Tomcat+Run</h4><ul>
<li>配置好Tomcat,然后运行,进行一下各种校验测试.</li>
<li>这个就不用贴了吧~贴了太侮辱智商了</li>
</ul>
<h4 id="3-7-Over"><a href="#3-7-Over" class="headerlink" title="3.7 Over"></a>3.7 Over</h4><blockquote>
<h5 id="感谢阅读-希望能对您有帮助-有问题请在留言中指出-祝您生活愉快"><a href="#感谢阅读-希望能对您有帮助-有问题请在留言中指出-祝您生活愉快" class="headerlink" title="感谢阅读,希望能对您有帮助,有问题请在留言中指出,祝您生活愉快~"></a>感谢阅读,希望能对您有帮助,有问题请在留言中指出,祝您生活愉快~</h5><h5 id="求赞"><a href="#求赞" class="headerlink" title="求赞~"></a>求赞~</h5></blockquote>
</body></html></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">XiaoMing</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://xiaoming0929.github.io/2020/04/02/SSM-Shiro%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/">https://xiaoming0929.github.io/2020/04/02/SSM-Shiro%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://XiaoMing0929.github.io">XiaoMing's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SSM/">SSM    </a><a class="post-meta__tags" href="/tags/Shiro/">Shiro    </a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/03/15/os7tu9STUCWx6Qe.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.jpg" alt="微信"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg" alt="支付寶"><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/04/02/%E9%9B%86%E5%90%88%E5%A4%A7%E6%9D%82%E7%83%A9/"><img class="prev_cover lazyload" data-src="https://i.loli.net/2020/03/15/Jbq5kQYoRwiAjp7.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>集合大杂烩</span></div></a></div><div class="next-post pull_right"><a href="/2020/04/02/Servlet%E9%A1%B5%E9%9D%A2%E8%B7%B3%E8%BD%AC-%E6%B5%85%E8%B0%88%E9%87%8D%E5%AE%9A%E5%90%91%E5%92%8C%E8%AF%B7%E6%B1%82%E8%BD%AC%E5%8F%91/"><img class="next_cover lazyload" data-src="https://i.loli.net/2020/03/15/c1J8rCvftZPiqVy.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>Servlet页面跳转-浅谈重定向和请求转发</span></div></a></div></nav></div></main><footer id="footer" style="background-image: url(https://i.loli.net/2020/03/15/os7tu9STUCWx6Qe.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2020 By XiaoMing</div><div class="footer_custom_text">一只积极向上的小妖怪。</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/fireworks.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script id="canvas_nest" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/canvas-nest.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script></body></html>